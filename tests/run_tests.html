<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>Salsopedia Test Suite</title>
    <style>
        body {
            font-family: sans-serif;
            background: #111;
            color: #fff;
            padding: 20px;
        }

        .test-case {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
        }

        .pass {
            border-color: green;
            color: #4eff4e;
        }

        .fail {
            border-color: red;
            color: #ff4e4e;
        }

        .pending {
            border-color: orange;
            color: orange;
        }

        h1 {
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>üîç Salsopedia Self-Diagnostic Tool</h1>
    <p>Ten skrypt sprawdzi, czy Twoje ≈õrodowisko lokalne jest gotowe do obs≈Çugi Salsopedii.</p>
    <button onclick="runTests()"
        style="padding:10px 20px; background:blue; color:white; border:none; cursor:pointer;">URUCHOM TESTY</button>

    <div id="results"></div>

    <script>
        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '';

            log('h2', '1. Testowanie Po≈ÇƒÖczenia (PHP)');
            await testFetch();

            log('h2', '2. Testowanie Skrypt√≥w (JS)');
            await testScripts();
        }

        async function testFetch() {
            try {
                // Test 1: Check Protocol
                if (window.location.protocol === 'file:') {
                    fail('Protok√≥≈Ç FILE:// wykryty. PHP nie zadzia≈Ça. Musisz u≈ºyƒá localhost.');
                    return;
                } else {
                    pass('Protok√≥≈Ç HTTP/HTTPS wykryty (OK).');
                }

                // Test 2: Fetch wiki.php
                const start = performance.now();
                const resp = await fetch('../assets/php/wiki.php?t=' + start);
                const text = await resp.text();

                if (resp.ok) {
                    pass('Po≈ÇƒÖczenie z wiki.php udane (HTTP 200).');
                } else {
                    fail('B≈ÇƒÖd po≈ÇƒÖczenia z wiki.php: ' + resp.status);
                    return;
                }

                // Test 3: Validate JSON
                try {
                    const json = JSON.parse(text);
                    pass('Dane JSON poprawne. Liczba hase≈Ç: ' + json.length);
                } catch (e) {
                    fail('Otrzymano niepoprawny JSON! Serwer zwraca b≈Çƒôdy PHP lub HTML. Tre≈õƒá: ' + text.substring(0, 100));
                }

            } catch (e) {
                fail('Krytyczny b≈ÇƒÖd sieci: ' + e.message);
            }
        }

        async function testScripts() {
            try {
                // Test 4: Load wiki.js dynamically
                const script = document.createElement('script');
                script.src = '../assets/js/wiki.js';
                document.body.appendChild(script);

                await new Promise((resolve) => script.onload = resolve);
                pass('Plik assets/js/wiki.js za≈Çadowany.');

                if (typeof window.initWiki === 'function') {
                    pass('Funkcja initWiki() jest dostƒôpna. Router bƒôdzie dzia≈Ça≈Ç.');
                } else {
                    fail('Brak funkcji initWiki()! Skrypt jest uszkodzony.');
                }

            } catch (e) {
                fail('Nie uda≈Ço siƒô za≈Çadowaƒá skrypt√≥w Salsopedii: ' + e.message);
            }
        }

        function log(tag, text) {
            const el = document.createElement(tag);
            el.innerText = text;
            document.getElementById('results').appendChild(el);
        }

        function pass(msg) {
            const el = document.createElement('div');
            el.className = 'test-case pass';
            el.innerText = '‚úÖ ' + msg;
            document.getElementById('results').appendChild(el);
        }

        function fail(msg) {
            const el = document.createElement('div');
            el.className = 'test-case fail';
            el.innerText = '‚ùå ' + msg;
            document.getElementById('results').appendChild(el);
        }
    </script>
</body>

</html>