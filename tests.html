<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>Salsopedia Auto-Tests</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: monospace;
            padding: 20px;
        }

        .pass {
            color: #0f0;
        }

        .fail {
            color: #f00;
            font-weight: bold;
        }

        .suite {
            margin-bottom: 20px;
            border: 1px solid #333;
            padding: 10px;
        }
    </style>
</head>

<body>
    <h1>Salsopedia Automated Tests</h1>
    <div id="results">Running tests...</div>

    <!-- Scripts to Test -->
    <script src="assets/js/contact.js"></script>
    <script src="assets/js/router.js"></script>
    <script src="assets/js/radio.js"></script>
    <script src="assets/js/home.js"></script>
    <!-- Wiki.js loaded last to check dependencies -->
    <script src="assets/js/wiki.js"></script>

    <script>
        const results = document.getElementById('results');
        let logHtml = '';
        let passed = 0;
        let failed = 0;

        function assert(condition, message) {
            if (condition) {
                logHtml += `<div class="pass">✔ PASS: ${message}</div>`;
                passed++;
            } else {
                logHtml += `<div class="fail">✘ FAIL: ${message}</div>`;
                failed++;
            }
        }

        function testSuite(name, fn) {
            logHtml += `<div class="suite"><h3>${name}</h3>`;
            try {
                fn();
            } catch (e) {
                logHtml += `<div class="fail">✘ EXCEPTION: ${e.message}</div>`;
                failed++;
            }
            logHtml += `</div>`;
        }

        window.onload = function () {
            results.innerHTML = '';

            testSuite('Router.js Integrity', () => {
                assert(typeof window.initHome === 'function', 'initHome is defined'); // From home.js, but used by router
                // Note: Router itself doesn't expose global functions besides initWiki logic check
                // assert(document.querySelector('script[src*="router.js"]'), 'Router script loaded');
            });

            testSuite('Wiki.js Integrity', () => {
                assert(typeof window.initWiki === 'function', 'initWiki is defined');
                assert(typeof window.renderTerms === 'function', 'renderTerms is defined');
                assert(typeof window.scrollToTerm === 'function', 'scrollToTerm is defined');
                assert(typeof window.openModal === 'function', 'openModal is defined');
            });

            testSuite('Radio.js Integrity', () => {
                assert(typeof window.initRadio === 'function', 'initRadio is defined');
            });

            testSuite('Contact Form Integrity', () => {
                // Determine if we are on index (has form) or not
                if (document.querySelector('form[name="contact"]')) {
                    assert(document.querySelector('form[name="contact"]'), 'Contact Form exists in DOM');
                    assert(document.getElementById('hp_chk'), 'Honeypot field (hp_chk) exists');
                    assert(document.getElementById('name'), 'Name field exists');
                } else {
                    // If running on tests.html standalone, we might not have the form unless we inject it or check main page
                    // Since tests.html is standalone, we can't easily check index.html content unless we fetch it.
                    // We will skip this verification if form is missing (expected in standalone tests.html)
                    logHtml += `<div class="warn">⚠ Note: Contact Form not present in tests.html (Expected)</div>`;
                }
            });

            testSuite('Wiki Moderation', () => {
                assert(typeof window.fetchPendingTerms === 'function', 'fetchPendingTerms is globally accessible');
                assert(typeof window.approveTerm === 'function', 'approveTerm is globally accessible');
                // Check if Wiki.js loaded
                if (typeof window.initWiki === 'function') {
                    assert(true, 'Wiki.js loaded successfully');
                }
            });

            testSuite('Contact Form Integrity', () => {
                if (document.querySelector('form[name="contact"]')) {
                    assert(document.querySelector('form[name="contact"]'), 'Contact Form exists in DOM');
                    assert(document.getElementById('hp_chk'), 'Honeypot field (hp_chk) exists');
                } else {
                    logHtml += `<div class="warn">⚠ Note: Contact Form not present in tests.html (Expected)</div>`;
                }
            });

            testSuite('Wiki Moderation', () => {
                assert(typeof window.fetchPendingTerms === 'function', 'fetchPendingTerms is globally accessible');
                // Check if Wiki.js loaded
                if (typeof window.initWiki === 'function') {
                    assert(true, 'Wiki.js loaded successfully');
                }
                // Check Button link
                // We can't check Salsopedia footer here easily without fetching it
            });

            results.innerHTML = `<h2>Summary: <span style="color:${failed === 0 ? '#0f0' : '#f00'}">${passed} Passed, ${failed} Failed</span></h2>` + logHtml;
        };
    </script>
</body>

</html>